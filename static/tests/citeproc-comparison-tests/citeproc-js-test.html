<html>
<head>
<title>Processing Citation Clusters (in-text citations)</title>
<meta charset="UTF-8">
<script src="file:///srv/www/lawccessenv/project-manager/static/citeproc-js/citeproc.js"></script>
<script>
citations = {"source7":
        {
            "id": "source7",
            "type": "article-journal",
            "title": "The Man of the Year Million",
            "container-title": "Paul Mall Gazette",
            "author": [
                {
                    "family": "Wells",
                    "given": "H.G."
                }
            ]
        },
	"source8":
        {
            "id": "source8",
            "type": "article-journal",
            "title": "Artificial intelligences and political organization: An exploration based on the science fiction work of Iain M. Banks",
            "URL": "http://www.sciencedirect.com/science/article/pii/S0160791X11000728",
            "author": [
                {
                    "family": "Rumpala",
                    "given": "Yannick"
                }
            ],
            "accessed": {
                "raw": "2016-04-06"
            }
        },
	"source3":
        {
            "id": "source3",
            "type": "article-journal",
            "title": "T. S. Eliot's Virgil: Dante",
            "container-title": "The Journal of English and Germanic Philology",
            "page": "50-65",
            "volume": "82",
            "issue": "1",
            "abstract": "In the Divine Comedy, Virgil guides Dante through hell. Virgil is the hero of the Roman epic, The Aeneid. These two classic works have had an impact on T.S. Eliot's own writing. Most notably, are the works of Dante, and this is why the title depicts him as a kind of Guide to Eliot. Throughout many of Eliot's works, allusions and subtle (and not so subtle) nods, to the works of Dante are present. This includes but is not limited to those present in The Wasteland. In determining just how important The Divine Comedy was to the creation, structure, and meaning of The Wasteland, one must look at how Eliot has recognized Dante throughout his other works. This essay attempts to do just that. It explores many of the references to Dante's works, as well as many of Eliot's references to ancient mythology, which may have in fact influenced Dante himself. The essay contains a lot of specificity in dealing with Dante in regards to Eliot's The Love Song Of J Alfred Prufrock.",
            "URL": "http://www.jstor.org/stable/27709117",
            "shortTitle": "T. S. Eliot's Virgil",
            "journalAbbreviation": "The Journal of English and Germanic Philology",
            "author": [
                {
                    "family": "Hay",
                    "given": "Eloise"
                }
            ],
            "issued": {
                "raw": "1983"
            },
            "accessed": {
                "raw": "2016-04-13"
            }
        },
	"source4":
        {
            "id": "source4",
            "type": "article-journal",
            "title": "What a beating feels like: authorship, dissolution, and masculinity in Sinclair's 'The Jungle.' (Upton Sinclair)",
            "container-title": "Studies in American Fiction",
            "page": "85+",
            "volume": "23",
            "issue": "1",
            "archive": "Academic OneFile",
            "URL": "http://go.galegroup.com/ps/i.do?id=GALE%7CA17173436&v=2.1&u=upitt_main&it=r&p=AONE&sw=w&asid=178d4869af0aceb85e1098b06275ae41",
            "note": "Derrick, Scott. \"What a beating feels like: authorship, dissolution, and masculinity in Sinclair's 'The Jungle.' (Upton Sinclair).\" Studies in American Fiction 23.1 (1995): 85+. Academic OneFile. Web. 6 Apr. 2016.\nURL\nhttp://go.galegroup.com/ps/i.do?id=GALE%7CA17173436&v=2.1&u=upitt_main&it=r&p=AONE&sw=w&asid=178d4869af0aceb85e1098b06275ae41",
            "shortTitle": "What a beating feels like",
            "language": "en-us",
            "author": [
                {
                    "family": "Hay",
                    "given": "Ellison"
                },
                {
                    "family": "Addison",
                    "given": "Margaret"
                }
            ],
            "issued": {
                "raw": "1983"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source1":
        {
            "id": "source1",
            "type": "article-journal",
			"subtype":"hope",
            "title": "Canonical and Non-Canonical: A Critique of the Current Debate",
            "container-title": "ELH",
            "page": "483-527",
            "volume": "54",
            "issue": "3",
            "URL": "http://www.jstor.org.pitt.idm.oclc.org/stable/2873219",
            "DOI": "10.2307/2873219",
            "shortTitle": "Canonical and Non-Canonical",
            "journalAbbreviation": "ELH",
            "author": [
                {
                    "family": "Guillory",
                    "given": "John",
					"misc":"Hope",
					"suffix":"butterworth"
                }
            ],
            "serials": [
                {
                   "volume": "24",
                    "container-title": "U.S.N.",
					"page":"163",
                    "family": "Samsung",
                    "given": "Josh",
					"suffix":"butterworth"
                },
                {
                   "volume": "17",
                    "container-title": "B.B.L.",
					"page":"13"
                }
            ],
			
            "issued": {
                "date-parts": [[1987,1,1],[2007,5,16],[2009,5,16]]
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source6":
        {
            "id": "source6",
            "type": "article-journal",
            "title": "The Diamond Age: Or a Young Lady's Illustrated Primer",
            "container-title": "On the Horizon",
            "page": "153-55",
            "volume": "18",
            "issue": "2",
            "URL": "http://www.emeraldinsight.com.pitt.idm.oclc.org/doi/full/10.1108/oth.2010.18.2.153.2",
            "DOI": "10.1108/oth.2010.18.2.153.2",
            "shortTitle": "The Diamond Age",
            "journalAbbreviation": "On the Horizon",
            "author": [
                {
                    "family": "Abeles",
                    "given": "Tom P."
                }
            ],
            "issued": {
                "raw": "May 18, 2010"
            },
            "accessed": {
                "raw": "2016-03-09"
            }
        },
	"source2":
        {
            "id": "source2",
            "type": "book",
			"edition":2,
            "title": "The Long and the Short of The Jungle.",
            "container-title": "Journalism History",
            "page": "165-167",
            "volume": "34",
            "issue": "3",
            "archive": "ufh",
            "abstract": "This article examines the 100 year anniversary of the publication of \"The Jungle,\" by Upton Sinclair. The author reviews the publication history of the book, which began in serialized form in the weekly magazine \"Appeal to Reason.\" A longer version was reissued in 1988 and again in 2003. The latter publication was accompanied by an introduction by professor Kathleen De Grave that claimed the original was edited by the publisher to make it more commercially palatable and that the restored version was closer to Sinclair's intent.",
            "URL": "http://search.ebscohost.com/login.aspx?direct=true&AuthType=ip,uid&db=ufh&AN=35117448&scope=site",
            "journalAbbreviation": "Journalism History",
            "author": [
                {
                    "family": "Boylan",
                    "given": "James"
                },
            ],
            "issued": {
                "raw": "2008"
            }       
    	},
	"source2-a":
        {
            "id": "source2-a",
            "type": "book",
			"edition":2,
            "title": "The Long and the Short of The Jungle.",
            "container-title": "Journalism History",
            "page": "165-167",
            "volume": "34",
            "issue": "3",
            "author": [
                {
                    "family": "Boylan",
                    "given": "James"
                },
/*                {
                    "family": "Abeles",
                    "given": "Tom P."
                }*/
            ],
            "issued": {
                "raw": "2008"
            }       
    	},
	"source2-b":
        {
            "id": "source2-b",
            "type": "book",
			"edition":2,
            "title": "The Long and the Short of The Jungle.",
            "container-title": "Journalism History",
            "page": "165-167",
            "volume": "34",
            "issue": "3",
            "author": [
                {
                    "family": "Boylan",
                    "given": "James"
                },
/*                {
                    "family": "Abeles",
                    "given": "Tom P."
                }*/
            ],
            "issued": {
                "raw": "2008"
            },
    	},
	"source5":
        {
            "id": "source5",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "abstract": "More than 100 years after Upton Sinclair denounced the massive slaughterhouse complex in Chicago as a â€œjungle,â€ qualitative case study research has documented numerous negative effects of slaughterhouses on workers and communities. Of the social problems observed in these communities, the increases in crime have been particularly dramatic. These increases have been theorized as being linked to the demographic characteristics of the workers, social disorganization in the communities, and increased unemployment rates. But these explanations have not been empirically tested, and no research has addressed the possibility of a link between the increased crime rates and the violent work that takes place in the meatpacking industry. This study uses panel analysis of 1994-2002 data on nonmetropolitan counties in states with â€œrightto-workâ€ laws (a total of 581 counties) to analyze the effect of slaughterhouses on the surrounding communities using both ordinary least squares and negative binomial regression. The findings indicate that slaughterhouse employment increases total arrest rates, arrests for violent crimes, arrests for rape, and arrests for other sex offenses in comparison with other industries. This suggests the existence of a â€œSinclair effectâ€ unique to the violent workplace of the slaughterhouse, a factor that has not previously been examined in the sociology of violence.",
            "URL": "http://oae.sagepub.com.pitt.idm.oclc.org/content/22/2/158",
            "DOI": "10.1177/1086026609338164",
            "journalAbbreviation": "Organization Environment",
            "language": "en",
            "author": [
                {
                    "family": "Fitzgerald",
                    "given": "Amanda J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-a":
        {
            "id": "source5-a",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "author": [
                {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                },
                {
                    "family": "Barney",
                    "given": "Levine"
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-b":
        {
            "id": "source5-b",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "journalAbbreviation": "Organization Environment",
            "author": [
                {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-c":
        {
            "id": "source5-c",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "journalAbbreviation": "Organization Environment",
            "author": [
                {
                    "family": "Fitzgerald",
                    "given": "Ashley J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                },
                {
                    "family": "Barney",
                    "given": "Levine"
                },
                {
                    "family": "Banish",
                    "given": "Jackson"
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-d":
        {
            "id": "source5-d",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "journalAbbreviation": "Organization Environment",
            "author": [
                {
                    "family": "Fitzgerald",
                    "given": "Kara J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-e":
        {
            "id": "source5-e",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "journalAbbreviation": "Organization Environment",
            "author": [
                {
                    "family": "Fitzgerald",
                    "given": "Kara J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kori"
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-f":
        {
            "id": "source5-f",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "journalAbbreviation": "Organization Environment",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                {
                    "family": "Kalof",
                    "given": "Peter"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                },
                {
                    "family": "Barney",
                    "given": "Lori"
                },

            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-g":
        {
            "id": "source5-g",
            "type": "article-journal",
            "title": "Slaughterhouses and Increased Crime Rates An Empirical Analysis of the Spillover From â€œThe Jungleâ€ Into the Surrounding Community",
            "container-title": "Organization & Environment",
            "page": "158-184",
            "volume": "22",
            "issue": "2",
            "journalAbbreviation": "Organization Environment",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                },
                {
                    "family": "Barney",
                    "given": "Lori"
                },

            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-h":
        {
            "id": "source5-h",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                },
                {
                    "family": "Barney",
                    "given": "Lori"
                },
                {
                    "family": "Drake",
                    "given": "Nathan"
                },

            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source5-i":
        {
            "id": "source5-i",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                {
                    "family": "Kalof",
                    "given": "Linda"
                },
                {
                    "family": "Dietz",
                    "given": "Thomas"
                },
                {
                    "family": "Hertz",
                    "given": "Kevin"
                },
                {
                    "family": "Barney",
                    "given": "Lara"
                },
                {
                    "family": "Duke",
                    "given": "Nathan"
                },
            ],
            "issued": {
                "raw": "06/01/2009"
            },
            "accessed": {
                "raw": "2016-04-07"
            }
        },
	"source6-a":
        {
            "id": "source6-a",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                 {
                    "family": "Cann",
                    "given": "Amy J."
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
		},
	"source6-b":
        {
            "id": "source6-b",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy J."
                },
                 {
                    "family": "VAnn",
                    "given": "Amy J."
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
		},
	"source6-c":
        {
            "id": "source6-c",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy K."
                },                 {
                    "family": "Jann",
                    "given": "Amy J."
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
		},
	"source6-d":
        {
            "id": "source6-d",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "DAmy K."
                },
                 {
                    "family": "Jann",
                    "given": "Amy J."
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
		},
	"source7-a":
        {
            "id": "source7-a",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy K. L. Ronnie Z."
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
		},
	"source7-b":
        {
            "id": "source7-b",
            "type": "article-journal",
            "author": [
                 {
                    "family": "Fitzgerald",
                    "given": "Amy K. L. Reggie Z."
                }
            ],
            "issued": {
                "raw": "06/01/2009"
            },
		},
}

</script>

<style>
.csl-entry {
	margin-top:20px;
	margin-bottom:20px;
}
blockquote::before {
	content: "\"";
}
blockquote::after {
	content: "\"";
}
blockquote {
   -moz-box-shadow:    inset 0 0 10px #000000;
   -webkit-box-shadow: inset 0 0 10px #000000;
   box-shadow:         inset 0 0 10px #000000;
	font:sans-serif;
	padding:15px;
	line-height:2em;
}
dl {
	border-top:1px solid gray;
	border-bottom:1px solid gray;
	padding:1em;
}
dt {
	font-style:italic;
	font-size:1:2em;
	margin-bottom:1em;
}
</style>
<script>

var xhr = new XMLHttpRequest();
const directory = 'file:///srv/www/lawccessenv/project-manager/static/data/styles/';
//xhr.open('GET', 'data/styles/chicagostyle-EN.xml', false);
//xhr.open('GET', 'data/styles/jm-indigobook.csl', false);
xhr.open('GET', directory+'apa.csl', false);
//xhr.open('GET', 'data/styles/logicValidation.csl', false);
//xhr.open('GET', directory+'bluebook-inline.csl', false);
xhr.send(null);
var style = xhr.responseText;

citeprocSys = {
  retrieveLocale: function (lang){
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'data/locales/locales-'+lang+'.xml', false);
    xhr.send(null);
    return xhr.responseText;
  },
  retrieveItem: function(id){
    return citations[id];
  }
};

// Instantiate processor
citeproc = new CSL.Engine(citeprocSys, style);


var firstCitationCluster = {
    'citationItems' : [ { "id": "source1", "locator":["pg. 14","n. 12","14"],"prefix":"see","suffix":"explanation: goes here"} ],
	'properties' : {}
}

var firstFormattedCitation = citeproc.processCitationCluster( firstCitationCluster, [ ] , [ ] );
var firstClusterID = firstFormattedCitation[1][0][2];

var secondCitationCluster = {
    'citationItems' : [ { "id": "source4" }, { "id": "source5", "locator":"p. 17" } ],
	'properties' : {}
}

var previousCitationClusters1 = [ [ firstClusterID , 0 ] ];
var followingCitationClusters1 = [ ];

var secondFormattedCitation = citeproc.processCitationCluster( secondCitationCluster, previousCitationClusters1 , followingCitationClusters1 );
var secondClusterID = secondFormattedCitation[1][0][2];


var thirdCitationCluster = {
    'citationItems' : [ { "id": "source2" }, { "id": "source3" } ],
	'properties' : {}
}

////
var previousCitationClusters2 = [ [ firstClusterID , 0 ] ];
var followingCitationClusters2 = [ [ secondClusterID , 0 ] ];

var thirdFormattedCitation = citeproc.processCitationCluster( thirdCitationCluster, previousCitationClusters2 , followingCitationClusters2 );

var thirdClusterID = thirdFormattedCitation[1][0][2];


/* simulating an edit of the first citation cluster */

//// Edit info for Source1
citations['source1']['author'][0]['family']="Gwendolin";

var firstCitationCluster2 = {
	'citationItems' : [ { "id": "source1" }, { "id": "source6" } ],
	'properties' : {},
	'citationID': firstClusterID,
	'sortedItems':[
		[
			citations['source1'],
			{
			"id":"source1",
			}
		],
		[
			citations['source6'],
			{
			"id":"source6",
			}
		]
	]
}

//// building other required parameters
var previousCitationClusters3 = [ ]; //// there are no clusters before the first cluster.
var followingCitationClusters3 = [ [thirdClusterID, 0 ], [secondClusterID, 0 ] ]; /// The ordering of the followingCitationClusters is important. The third cluster occurs before the second cluster in the example text.

firstFormattedCitation2 = citeproc.processCitationCluster( firstCitationCluster2, previousCitationClusters3 , followingCitationClusters3 );

/* end simulation of edit of the first citaiton cluster */

/* simulation of creating fourth citation cluster */

var fourthCitationCluster = {
	'citationItems' : [ { "id": "source1" }, { "id": "source5" } ],
	'properties' : {},
}

//// building other required parameters

var previousCitationClusters4 = [ [ firstClusterID , 0 ], [ thirdClusterID , 0 ] ]; 
var followingCitationClusters4 = [ [secondClusterID, 0 ] ]; 

fourthFormattedCitation = citeproc.processCitationCluster( fourthCitationCluster, previousCitationClusters4 , followingCitationClusters4 );

fourthClusterID = fourthFormattedCitation[1][0][2]

/* end simulation of creating fourth citation cluster */




/////// APA.CSL TESTING results //////////////////
/* TEST Source Occuring Twice in One Cluster */
sameCluster1 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source2", "locator":"p. 62-63"}, {"id":"source2","locator":"p. 67"}],
		"properties":{},
	},
	[], [],
)[1][0]; /// "(Boylan, 2008, pp. 62–63, 2008, p. 67)"

var ID = sameCluster1[2];

sameCluster2 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source2", "locator":"p. 62-63"}, {"id":"source3","locator":"p. 167"}, {"id":"source2","locator":"p. 67"}],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0]; /// "(Boylan, 2008, pp. 62–63, 2008, p. 67; Hay, 1983, p. 167)" => collapse == "year"
/// "(Boylan, 2008, pp. 62–63, false, , p. 67; Hay, 1983, p. 167)" => collapse == "year-suffix" // BUG
/// "(Boylan, 2008, pp. 62–63, 2008, p. 67; Hay, 1983, p. 167)" => collapse == "year-suffix-range"

//	{"citationItems": [ {"id":"source2", "locator":"p. 62-63"},{"id":"source2-a", "locator":"p. 22-83"} ],
testCiteCollapse1 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source2"},{"id":"source2-a"},{"id":"source2-b"}	 ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0]; /// "(Boylan, 2008a, pp. 62–63; Boylan, 2008b, pp. 22–83)" => collapse == none;
/// "(Boylan, 2008a, pp. 62–63, 2008b, pp. 22–83)" => collapse == "year"
/// "(Boylan, 2008a, pp. 62–63, false, /b, pp. 22–83)" => collapse == "year-suffix" // BUG
/// "(Boylan, 2008a, pp. 62–63, false, /b, pp. 22–83)" => collapse == "year-suffix-range"//BUG
/// w/o "locator" => "(Boylan, 2008a; Boylan, 2008b)" WHERE collapse == "year"
/// w/o "locator" => "(Boylan, 2008a, false, /b)" WHERE collapse == "year-suffix"
/// w/o "locator" => "(Boylan, 2008a, 2008b)" WHERE collapse == "year-suffix-range" // BUG
//// w/ 3 sources & no locator => "(Boylan, 2008a, 2008b, 2008c)" WHERE collapste = "year-suffix-range" //BUG


//// name expansion & name addition needed to successfully disambiguate. 
testDisambig1 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5"},{"id":"source5-a"},{"id":"source5-b"} ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
//// "(Amanda J. Fitzgerald et al., 2009; Amy J. Fitzgerald, Kalof, Dietz, &#38; Hertz, 2009; Amy J. Fitzgerald, Kalof, Dietz, Hertz, et al., 2009)"
// * the Middle initial still given, even though it provides no disambiguation in this context.
// * et. al. can successfully disambiguate a cite.


//// name intialization & name expansion needed to successfully disambiguate. 
testDisambig2 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5-a"},{"id":"source5-d"},{"id":"source5"}, ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
/// "(Amanda J. Fitzgerald et al., 2009; Amy J. Fitzgerald et al., 2009; K. J. Fitzgerald et al., 2009)"
/// Amanda & Amy still have initials, even though it is not required.
// * Amanda & Amy are not disambiguated WHERE givenname-disambiguation-rule == "primary-name-with-initials" => "(A. J. Fitzgerald, Kalof, Dietz, &#38; Hertz, 2009; A. J. Fitzgerald, Kalof, Dietz, Hertz, et al., 2009; K. J. Fitzgerald, Kalof, Dietz, &#38; Hertz, 2009)"


//// Name expansion & name addition both successfully disambiguate. Testing processor preferences.
testDisambig3 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5-a"},{"id":"source5-c"},{"id":"source5"}, ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
/// "(Amanda J. Fitzgerald et al., 2009; Amy J. Fitzgerald et al., 2009; Ashley J. Fitzgerald et al., 2009)"
/// * Prefered name expansion over name addition. Even when givenname-disambiguation-rule = "by-cite".
/// WHERE "disambiguate-add-givenname" == false || givenname-disambiguation-rule == "primary-name-with-initials" => "(Fitzgerald, Kalof, Dietz, &#38; Hertz, 2009; Fitzgerald, Kalof, Dietz, Hertz, &#38; Barney, 2009; Fitzgerald, Kalof, Dietz, Hertz, Barney, et al., 2009)"



//// Testing givenname-disambiguation-rule
testDisambig4 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5-d"},{"id":"source5-e"} ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
/// WHERE "disambiguate-add-givenname" == true ...
/// WHERE givenname-disambiguation-rule == "primary-name" => "(Fitzgerald, Kalof, Dietz, &#38; Hertz, 2009a, 2009b)" !!!! cite-collapse w/ year-disambiguation.
/// WHERE givenname-disambiguation-rule == "all-names-with-initials" => "(Fitzgerald, Kalof, Dietz, &#38; Hertz, 2009a, 2009b)" !!!! cite-collapse w/ year-disambiguation.
/// WHERE givenname-disambiguation-rule == "by-cite" => "(Fitzgerald, Kalof, Dietz, & Kevin Hertz, 2009; Fitzgerald, Kalof, Dietz, & Kori Hertz, 2009)"

testDisambig5 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5-f"},{"id":"source5-a"} ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
/// WHERE "disambiguate-add-givenname" == true ...
/// WHERE givenname-disambiguation-rule == "all-names-with-initials" => "(Fitzgerald, L. Kalof, Dietz, Hertz, &#38; Barney, 2009; Fitzgerald, P. Kalof, Dietz, Hertz, &#38; Barney, 2009)"
/// WHERE givenname-disambiguation-rule == "by-cite" => "(Fitzgerald, L. Kalof, Dietz, Hertz, &#38; Barney, 2009; Fitzgerald, P. Kalof, Dietz, Hertz, &#38; Barney, 2009)"
/// WHERE givenname-disambiguation-rule == "all-names" => (Fitzgerald, L. Kalof, Dietz, Hertz, &#38; Levine Barney, 2009; Fitzgerald, P. Kalof, Dietz, Hertz, &#38; Lori Barney, 2009)


testDisambig6 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5-f"},{"id":"source5-a"},{"id":"source5-g"} ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
//// WHERE "givenname-disambiguation-rule" == "by-cite"
/// "(Fitzgerald, L. Kalof, Dietz, Hertz, &#38; Levine Barney, 2009; Fitzgerald, L. Kalof, Dietz, Hertz, &#38; Lori Barney, 2009; Fitzgerald, P. Kalof, et al., 2009)"
/// Transformation on a citation stops once it has been successfully disambiguated

testDisambig7 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source5-f"},{"id":"source5-h"},{"id":"source5-i"} ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
//// WHERE "givenname-disambiguation-rule" == "by-cite"
/// "(Fitzgerald, L. Kalof, Dietz, Hertz, Lara Barney, et al., 2009; Fitzgerald, L. Kalof, Dietz, Hertz, Lori Barney, et al., 2009; Fitzgerald, P. Kalof, et al., 2009)"
/// Proves that 'disambiguation-add-givenname' has priority over 'disambiguation-add-names' CONTRA the CSL specification.


///// ET-AL-SUBSEQUENT TEST
testEtAlMinBug1 = citeproc.processCitationCluster({"citationItems":[{"id":"source5-a"}],"properties":{}},[],[])[1][0];


testEtAlMinBug2 = citeproc.processCitationCluster({"citationItems":[{"id":"source5-a"}],"properties":{}},[ [testEtAlMinBug1[2],0] ],[])[1][0];
console.log(testEtAlMinBug1[1], testEtAlMinBug2[1])



FourWayDisambig1 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source6-a"} ],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
FourWayDisambig2 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source6-b"} ],
		"properties":{"note-index":0},
	},
	[ [FourWayDisambig1[2],0] ], [],
)[1];
FourWayDisambig3 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source6-c"} ],
		"properties":{"note-index":0},
	},
	[ [FourWayDisambig1[2],0], [FourWayDisambig2[1][2],0] ], [],
)[1];
FourWayDisambig4 = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source6-d"} ],
		"properties":{"note-index":0},
	},
	[ [FourWayDisambig1[2],0] , [FourWayDisambig2[1][2],0] , [FourWayDisambig3[0][2],0] ], [],
)[1];

console.log(FourWayDisambig1[1], FourWayDisambig2[1], FourWayDisambig3, FourWayDisambig4)
//// Middle Name + suffix differentiation (A. J. Fitzgerald, 2009a), (A. J. Fitzgerald, 2009b), (A. K. Fitzgerald, 2009a), (A. K. Fitzgerald, 2009b)



//////// Initialize Disambiguation Length
InitializationDisambigLength = citeproc.processCitationCluster(
	{"citationItems": [ {"id":"source7-a"},{"id":"source7-b"}],
		"properties":{"note-index":0},
	},
	[ ], [],
)[1][0];
///// => "(A. K. L. Reggie Z. Fitzgerald, 2009; A. K. L. Ronnie Z. Fitzgerald, 2009)" => infinite initialization && add ALL initials before spelling out names!!!!


//// et-al. test ////
//test = citeproc.processCitationCluster( secondCitationCluster, [ [firstClusterID, 0], [thirdClusterID, 1], [fourthClusterID, 2] ], [ ] );

</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation disambiguate-add-names="true" disambiguate-add-givenname="true" givenname-disambiguation-rule="by-cite" initialize-with="."><layout><names variable="author" suffix=" / " ><name form="short"></name></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);

citations['disambig1'] = {
    "id": "disambig1",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Ronnie. Zoe",
			"suffix":"II",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
}
citations['disambig2'] = {
    "id": "disambig2",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Ronnie. Zoe",
			"suffix":"III",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
}

citeproc = new CSL.Engine(citeprocSys, style);
var disambiggy
console.log(disambiggy =citeproc.processCitationCluster({citationItems:[{"id":"disambig1"},{"id":"disambig2"}],properties:{}},[],[])[1][0][1]);
//document.write(disambiggy);
/// no possible disambiguation --> "Fitzgerald, de / Fitzgerald, de / "
/// disambiguation by non-dropping-particle --> "Fitzgerald, la / Fitzgerald, le / "
/// disambiguation by suffix --> "Fitzgerald, A.K.L.R.Z. de la, III / Fitzgerald, A.K.L.R.Z. de la, II / "
/// disambiguation by initial --> "Fitzgerald, A.K.L.R.Z. de la, III / Fitzgerald, A.K.C.R.Z. de la, III / "
/// disambiguation by dropping-particle --> "Fitzgerald, A.K.L.R.Z. de la, III / Fitzgerald, A.K.L.R.Z. de la, III / "
/// disambiguation by name-expansion --> "Fitzgerald, Amy K. Lara Ronnie. Zoe de la, III / Fitzgerald, Amy K. Louie Ronnie. Zoe de la, III / "
</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation disambiguate-add-names="true" disambiguate-add-givenname="true" givenname-disambiguation-rule="by-cite" initialize-with="."><layout><names variable="author" suffix=" / " ><name form="short"></name></names><text variable="locator"></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);

citations['disambig1'] = {
    "id": "disambig1",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Ronnie. Zoe",
			"suffix":"II",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
}
citations['disambig2'] = {
    "id": "disambig2",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Ronnie. Zoe",
			"suffix":"III",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
}

citeproc = new CSL.Engine(citeprocSys, style);
var disambiggy
console.log(disambiggy =citeproc.processCitationCluster({citationItems:[{"id":"disambig1","locator":"17"},{"id":"disambig2","locator":"47"}],properties:{}},[],[])[1][0][1]);
//document.write(disambiggy);

//// Proves that citeproc does not confused by locator variable for disambiguation.
</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation disambiguate-add-names="true" disambiguate-add-givenname="true" givenname-disambiguation-rule="by-cite" initialize-with="."><layout><names delimiter="; " variable="editor author" suffix=" / " ><name form="short"></name></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v

citations['disambig1'] = {
    "id": "disambig1",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "editor": [
         {
            "family": "Koonz",
            "given": "Amy"
        }
    ],
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Ronnie Zoe",
			"suffix":"II",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
},
citations['disambig2'] = {
    "id": "disambig2",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
	"editor": [
		{
			"family":"Koonz",
			"given":"Marcy"
		}
	],
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Ronnie Zoe",
			"suffix":"III",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
},
citations['disambig3'] = {
    "id": "disambig3",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
	"editor": [
		{
			"family":"Koonz",
			"given":"Marcy"
		}
	],
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy K. Lara Remy Zoe",
			"suffix":"III",
			"dropping-particle":"de",
			"non-dropping-particle":"la",
        }
    ],
}

citeproc = new CSL.Engine(citeprocSys, style);
var disambiggy
console.log(disambiggy =citeproc.processCitationCluster({citationItems:[{"id":"disambig1"},{"id":"disambig2"},{"id":"disambig3"}],properties:{}},[],[])[1][0][1]);
//document.write(disambiggy);
/// "A. Koonz; la Fitzgerald / M. Koonz; Amy K. Lara Ronnie Zoe de la Fitzgerald III / M. Koonz; Amy K. Lara Remy Zoe de la Fitzgerald III / "
/// example of multiple disambiguation strategies used at the same time.
</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation disambiguate-add-names="true" disambiguate-add-givenname="true" givenname-disambiguation-rule="by-cite"><layout><names delimiter="; " variable="author editor" suffix=" / " ><name  et-al-min="2" et-al-use-first="1" form="short"></name></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v

citations['disambig1'] = {
    "id": "disambig1",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "editor": [
         {
            "family": "Koonz",
            "given": "Amy"
        }
    ],
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy"
        },
         {
            "family": "Morgan",
            "given": "Samuel"
        }
    ],
},
citations['disambig2'] = {
    "id": "disambig2",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
	"editor": [
		{
			"family":"Koonz",
			"given":"Marcy"
		}
	],
    "author": [
         {
            "family": "Fitzgerald",
            "given": "Amy"
        },
         {
            "family": "Morgan",
            "given": "Adam"
        }
    ],
}

citeproc = new CSL.Engine(citeprocSys, style);
var disambiggy
console.log(disambiggy =citeproc.processCitationCluster({citationItems:[{"id":"disambig1"},{"id":"disambig2"}],properties:{}},[],[])[1][0][1]);
//document.write(disambiggy);
/// Fitzgerald, Samuel Morgan; Koonz / Fitzgerald, Adam Morgan; Koonz / 
/// NOT: Fitzgerald; Amy Koonz / Fitzgerald; Marcy Koonz / 
////The documentation is not clear about the following scenario. Should the Processor add & expand hidden names in the first variable name list OR should the Processor first expand the non-hidden names in the second (or third) variable name list? The citeproc processor uses the first method of adding and expanding hidden names, before it tries to expand the visible names in following name variables.
</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation disambiguate-add-givenname="true" givenname-disambiguation-rule="all-names"><layout><names delimiter="; " variable="author editor" suffix=" / " ><name form="short"></name></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v

citations['disambig1'] = {
    "id": "disambig1",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "editor": [
         {
            "family": "Koonz",
            "given": "Amy"
        }
    ],
},
citations['disambig2'] = {
    "id": "disambig2",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
	"editor": [
		{
			"family":"Koonz",
			"given":"Marcy"
		}
	],
}

citeproc = new CSL.Engine(citeprocSys, style);
var disambiggy
console.log(disambiggy =citeproc.processCitationCluster({citationItems:[{"id":"disambig1"},{"id":"disambig2"}],properties:{}},[],[])[1][0][1]);
//document.write(disambiggy);
/// "Amy Koonz / Marcy Koonz /"     givenname-disambiguation-rule= "by-cite" & disambiguate-add-givenname="true"
/// proves that by default, initialization disambiguation is not used. 
/// "Amy Koonz / Marcy Koonz /"     givenname-disambiguation-rule= "all-names" & disambiguate-add-givenname="true"
/// "Amy Koonz / Marcy Koonz /"     givenname-disambiguation-rule= "all-names" & disambiguate-add-givenname="false"
//// The first 3 examples suggests that there is no difference between "by-cite" & "all-names" when there is just a single name.
//// The attribute "disambiguate-add-givenname" operates as a toggle of how the Processor is to interprate the "given-name-disambiguation rule".
/// "Koonz / Koonz /"           givenname-disambiguation-rule="all-names-with-initials" & disambiguate-add-givenname="false". No initialization, b/c "initialize-with" is not set.
/// "A. Koonz / M. Koonz /"           givenname-disambiguation-rule="all-names-with-initials" & disambiguate-add-givenname="true" & NOTE: "initialize-with" is not set, but the Processor still allows initialization! This is behavior is definitely not in the spec. 
/// "Koonz / Koonz /"           givenname-disambiguation-rule="all-names-with-initials" & disambiguate-add-givenname="true" & name initials match. When given name "Marcy" is changed to "Andy" so that the initialized forms of both names match, the "-with-initials" limitation is a applies to general name disambiguation & cite disambiguation - so the disambiguation fails.

/// proves that by default, initialization disambiguation is not used. 
</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation disambiguate-add-givenname="true" givenname-disambiguation-rule="primary-name-with-initials"><layout><names delimiter="; " variable="author editor" suffix=" / " ><name form="short" initialize-with=","></name></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v

citations['disambig1'] = {
    "id": "disambig1",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
    "editor": [
         {
            "family": "Koonz",
            "given": "Amy"
        },
         {
            "family": "Moore",
            "given": "Amy"
        }
    ],
},
citations['disambig2'] = {
    "id": "disambig2",
    "type": "article-journal",
    "issued": {
        "raw": "May 18, 2010",
    },
	"editor": [
		{
			"family":"Koonz",
			"given":"Marcy"
		},
         {
            "family": "Moore",
            "given": "Marcy"
        }
	],
}

citeproc = new CSL.Engine(citeprocSys, style);
var disambiggy
console.log(disambiggy =citeproc.processCitationCluster({citationItems:[{"id":"disambig1"},{"id":"disambig2"}],properties:{}},[],[])[1][0][1]);
//document.write(disambiggy); ///// DISAPPOINTING
/// "Amy Koonz, Amy Moore / Marcy Koonz, Marcy Moore / "     givenname-disambiguation-rule= "by-cite" & disambiguate-add-givenname="true"
/// "Koonz, Moore / Koonz, Moore / "   						 givenname-disambiguation-rule= "by-cite" & disambiguate-add-givenname="false"
/// "Amy Koonz, Amy Moore / Marcy Koonz, Marcy Moore / "     givenname-disambiguation-rule= "all-names" & disambiguate-add-givenname="false"
/// "Amy Koonz, Amy Moore / Marcy Koonz, Marcy Moore / "     givenname-disambiguation-rule= "all-names" & disambiguate-add-givenname="true"
/// "A Koonz, A Moore / M Koonz, M Moore / "    			 givenname-disambiguation-rule= "all-names-with-initials" & disambiguate-add-givenname="true"   !!!! WRONG: disambiguation not limited to primary name
/// "Koonz, Moore / Koonz, Moore / "     					 givenname-disambiguation-rule= "all-names-with-initials" & disambiguate-add-givenname="false"  !!!! WRONG: no global disambiguation
/// "Amy Koonz, Moore / Marcy Koonz, Moore / "    			 givenname-disambiguation-rule= "primary-names" & disambiguate-add-givenname="true"	!! note: name disambig within scope of primary names; not by-cite.
/// "Koonz, Moore / Koonz, Moore / "    					 givenname-disambiguation-rule= "primary-names" & disambiguate-add-givenname="false" !!!!! WRONG: no disambiguation
/// "Amy Koonz, Moore / Marcy Koonz, Moore / "    			 givenname-disambiguation-rule= "primary-names-with-initials" & disambiguate-add-givenname="true" !!!! WRONG: doesn't initialize
/// "Koonz, Moore / Koonz, Moore / "    					 givenname-disambiguation-rule= "primary-names-with-initials" & disambiguate-add-givenname="false" !!!!! WRONG: no global disambiguation


/// "A, Koonz, Moore / M, Koonz, Moore /"  			givenname-disambiguation-rule= "by-cite" & disambiguate-add-givenname="true" & initialize-with=","
/// "Koonz, Moore / Koonz, Moore /"    				givenname-disambiguation-rule= "by-cite" & disambiguate-add-givenname="false" & initialize-with=","
/// "A, Koonz, A, Moore / M, Koonz, M, Moore /"     givenname-disambiguation-rule= "all-names" & disambiguate-add-givenname="true" & initialize-with=","
/// "Koonz, Moore / Koonz, Moore /"     			givenname-disambiguation-rule= "all-names" & disambiguate-add-givenname="false" & initialize-with="," !!!! WRONG
/// "A, Koonz, A, Moore / M, Koonz, M, Moore /"     givenname-disambiguation-rule= "all-names-with-initials" & disambiguate-add-givenname="true" & initialize-with=","
/// "Koonz, Moore / Koonz, Moore /"     			givenname-disambiguation-rule= "all-names-with-initials" & disambiguate-add-givenname="false" & initialize-with="," !!!! WRONG
/// "A, Koonz, Moore / M, Koonz, Moore /"    		givenname-disambiguation-rule= "primary-name" & disambiguate-add-givenname="true" & initialize-with=","
/// "Koonz, Moore / Koonz, Moore /"     			givenname-disambiguation-rule= "primary-name" & disambiguate-add-givenname="false" & initialize-with="," !!!! WRONG
/// "A, Koonz, Moore / M, Koonz, Moore /"    		givenname-disambiguation-rule= "primary-name-with-initials" & disambiguate-add-givenname="true" & initialize-with=","
/// "Koonz, Moore / Koonz, Moore /"     			givenname-disambiguation-rule= "primary-name-with-initials" & disambiguate-add-givenname="false" & initialize-with="," !!!! WRONG



//// The first 3 examples prove that there is no difference between "by-cite" & "all-names".
//// The attribute "disambiguate-add-givenname" operates as a toggle of how the Processor is to interprate the "given-name-disambiguation rule".
/// "Koonz / Koonz /"           givenname-disambiguation-rule="all-names-with-initials" & disambiguate-add-givenname="false". No initialization, b/c "initialize-with" is not set.
/// "A. Koonz / M. Koonz /"           givenname-disambiguation-rule="all-names-with-initials" & disambiguate-add-givenname="true" & NOTE: "initialize-with" is not set, but the Processor still allows initialization! This is behavior is definitely not in the spec. 
/// "Koonz / Koonz /"           givenname-disambiguation-rule="all-names-with-initials" & disambiguate-add-givenname="true" & name initials match. When given name "Marcy" is changed to "Andy" so that the initialized forms of both names match, the "-with-initials" limitation is a applies to general name disambiguation & cite disambiguation - so the disambiguation fails.

/// proves that by default, initialization disambiguation is not used. 
</script>
<script>
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation><layout><group font-weight="bold" prefix="hi - "><text prefix="where - " font-style="italic" font-weight="normal" variable="title"/><group prefix="- home" text-case="lowercase"><text prefix="nana" font-style="italic" text-decoration="underline" variable="container-title" suffix=" "/><text text-decoration="underline" variable="type"/></group></group><group text-decoration="underline"><text text-decoration="none" variable="type" suffix=" "/><text text-decoration="none" variable="container-title" suffix="."/></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v
console.log(v =citeproc.processCitationCluster({citationItems:[{"id":"source2"}],properties:{}},[],[])[1][0][1]);
//document.write(v); //// citeproc does not gracefully handle when a child element of <group> over-rides a decorator set by <group>. 
/// Also note that citeproc does not apply decorators to "suffix" or "prefix" attributes of a node. This behavior is not defined in the specification.

</script>
<script>
//// Does date-ranges that include days force both day parts to ordinal form? yes
citations['date1'] =
        {
            "id": "date1",
            "type": "article-journal",
            "issued": {
                "raw": "May 18, 2010",
            },
            "accessed": {
                "raw": "2016-03-01/2016-03-07"
            }
        }
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><locale xml:lang="en-US">   <style-options limit-day-ordinals-to-day-1="true"/> <term name="ordinal">ᵉ</term>    <term name="ordinal-01" gender-form="feminine" match="whole-number">ʳᵉ</term>    <term name="ordinal-01" gender-form="masculine" match="whole-number">ᵉʳ</term></locale><citation><layout>      <date variable="accessed">  <date-part name="year" range-delimiter="/" suffix=" "/>    <date-part name="day" suffix=" " range-delimiter="-" form="ordinal"/>        <date-part name="month" suffix="/"/>           </date></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v1
console.log(v1 =citeproc.processCitationCluster({citationItems:[{"id":"date1"}],properties:{}},[],[])[1][0][1]); // "2016 1e–7e March/"
document.write(v1); //// When day-part is set to ordinal, and is given a date-range to render: both items in the range are given the orginal form.
//// Tricky case -> Processor must handle a range of days that occurs between non-changing month and year parts. 
//// Suffixes only appear at the end of the date-range range for the implicated date-parts. Thus 
// "2016 1e January–7e March/" <-- No "/" suffix at the end of "January".
</script>
<script>
///// ISSUE: The specification does not clarify whether Localized date-parts override non-localized date - or vice versa.

//// Does date-ranges that include days force both day parts to ordinal form? yes
citations['date2'] =
        {
            "id": "date2",
            "type": "article-journal",
            "issued": {
                "raw": "May 18, 2010",
            },
            "accessed": {
                "raw": "2016-03-01 / 2016-08-07"
            }
        };
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><locale xml:lang="en-US">   <style-options limit-day-ordinals-to-day-1="true"/> <date form="text" ><date-part name="year" range-delimiter="/" suffix=" "/>      <date-part name="day" suffix=" " range-delimiter="-" form="numeric-leading-zeros"/>        <date-part name="month" font-weight="bold" strip-periods="true" form="short" suffix="/"  />             </date> <term name="ordinal">ᵉ</term>    <term name="ordinal-01" gender-form="feminine" match="whole-number">ʳᵉ</term>    <term name="ordinal-01" gender-form="masculine" match="whole-number">ᵉʳ</term></locale><citation><layout>      <date variable="accessed" form="text"  text-case="uppercase" font-weight="bold" font-style="italic" ><date-part name="month" font-style="italic" suffix="/**/" /></date></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v2
console.log(v2 =citeproc.processCitationCluster({citationItems:[{"id":"date2"}],properties:{}},[],[])[1][0][1]); "March 1–August 7, 2016 "
//document.write(v2); //// Citeproc.js does not properly implement "text-case" inheritance from the <date> element. "2016 01 Mar.–07 Aug./" instead of "2016 01 MAR.–07 AUG./" 
//// 2016 01 <i>March</i>–07 <i>August</i>//" instead of "<b><i>2016 01 March-07 August/</i></b>"Citeproc.js also does not apply the Decorations set on <date> elements.
//// 2016 01 March–07 August/++/" instead of "2016 01 March-07 August/". Citeproc.js improperly allows non-localized date-part affixes to override localized date-part affixes.
</script>
<script>
citations['name1'] =
    {
        "id": "name1",
        "type": "article-journal",
        "author": [{family:'Cash',given:"Bandy"},{family:'Ash',given:"Candy"},{family:'Bash',given:"Andy"}],
    };
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation><layout><names variable="author"><name name-as-sort-order="all" delimiter="; " and="symbol" /></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v3
console.log(v3 =citeproc.processCitationCluster({citationItems:[{"id":"name1"}],properties:{}},[],[])[1][0][1]);
//document.write(v3); //// citeproc does not gracefully handle when a child element of <group> over-rides a decorator set by <group>. 
/// Also note that citeproc does not apply decorators to "suffix" or "prefix" attributes of a node. This behavior is not defined in the specification.

</script>
<script>
citations['group-delimiter'] =
    {
        "id": "group-delimiter",
        "type": "article-journal",
        "author": [{family:'Cash',given:"Bandy"},{family:'Ash',given:"Candy"},{family:'Bash',given:"Andy"}],
    };
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation><layout><group text-decoration="underline" delimiter=", "><group><text value="hial"/></group><names variable="author"><name><name-part name="given" text-case="uppercase"/><name-part font-weight="bold" name="family" /></name></names></group></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v4
console.log(v4 =citeproc.processCitationCluster({citationItems:[{"id":"group-delimiter"}],properties:{}},[],[])[1][0][1]);
//document.write(v4); //// shows that citeproc formatting is correct for when <group> node's first child is another <group> node --> I had a sneaky bug in my code that didn't handle this.
</script>
<script>
citations['namesVname'] =
    {
        "id": "namesVname",
        "type": "article-journal",
        "author": [{family:'Cash',given:"Bandy", suffix:"III"},{family:'Ash',given:"Candy"},{family:'Bash',given:"Andy"}],
		"editor": [{family:'Dex',given:'Brandy'}]
    };
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation><layout><names variable="author editor" delimiter="; " font-style="italic"><name et-al-min="3" et-al-use-first="2" name-as-sort-order="first" text-decoration="underline"><name-part name="given" text-case="uppercase"/ prefix="+" suffix="-"><name-part font-weight="bold" name="family" suffix="+" /></name></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v5
console.log(v5 =citeproc.processCitationCluster({citationItems:[{"id":"namesVname"}],properties:{}},[],[])[1][0][1]);
//document.write(v5); //// <i><span style="text-decoration:underline;"><span style="text-decoration:underline;"><b>Cash</b>+, +BANDY-, III</span>, <span style="text-decoration:underline;">+CANDY- <b>Ash</b>+</span>, et al.</span>; <span style="text-decoration:underline;"><b>Dex</b>+, +BRANDY-</span></i>
//// This test shows that citeproc handles Name-part formatting very well. Formatting set on <names> applies to all content; formatting set on <name> applies to name-parts, delimiters, and sort-separators; formatting set on <name-part> elements only applies to those elements. Suffix set on family includes the name-suffix, even as the decorators don't include name-suffix - which conforms with the spec.
// Also shows how multiple nameLists can be displayed with a single <names> element.
</script>
<script>
citations['namesLabel'] =
    {
        "id": "namesLabel",
        "type": "article-journal",
        "translator": [{family:'Cash',given:"Bandy", suffix:"III"},{family:'Ash',given:"Candy"},{family:'Bash',given:"Andy"}],
		"editor": [{family:'Dex',given:'Brandy'}]
    };
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation><layout><names variable="translator editor" delimiter="; " font-style="italic"><name /><label/></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v6
console.log(v6 =citeproc.processCitationCluster({citationItems:[{"id":"namesLabel"}],properties:{}},[],[])[1][0][1]);
//document.write(v6); //// Shows how the Name's <label> support falls down. The spec requires that the <label> element occur after <name> and <et-al>, but before <substitution>. In citeproc, changing the position of the <label> changes where the label occurs. 
</script>
<script>
citations["namesSort1"] =
    {
        "id": "namesSort1",
        "author": [{family:'Anderson',given:"Bandy", "non-dropping-particle": "z", suffix:"III"},{family:'Ash',given:"Candy", "non-dropping-particle": "a",},{family:'Bash',given:"Andy","non-dropping-particle": "k"}],
    };
citations["namesSort2"] =
    {
        "id": "namesSort2",
        "author": [{family:'Zanderson',given:"Bandy", "non-dropping-particle": "a", suffix:"III"},{family:'Ash',given:"Candy", "non-dropping-particle": "a",},{family:'Bash',given:"Andy","non-dropping-particle": "k"}],
    };
var style = '<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0"><info></info><citation><sort><key variable="author" /></sort><layout><names variable="author" delimiter="; " font-style="italic"><name /><label/></names></layout></citation></style>';
citeproc = new CSL.Engine(citeprocSys, style);
var v7
console.log(v7 =citeproc.processCitationCluster({citationItems:[{"id":"namesSort1"},{"id":"namesSort2"}],properties:{}},[],[])[1][0][1]);
//document.write(v7); //// Shows how the Name's <label> support falls down. The spec requires that the <label> element occur after <name> and <et-al>, but before <substitution>. In citeproc, changing the position of the <label> changes where the label occurs. 
</script>
</head>
<body>
</body>
</html>
